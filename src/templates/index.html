<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCBé˜»æŠ—è®¡ç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .admin-link {
            position: absolute;
            top: 0;
            right: 0;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .admin-link:hover {
            background: rgba(255,255,255,0.3);
        }

        .calc-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .calc-container {
                grid-template-columns: 1fr;
            }
        }

        .calc-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .calc-card:hover {
            transform: translateY(-5px);
        }

        .calc-type {
            margin-bottom: 20px;
        }

        .calc-type label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        .calc-type select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .calc-type select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-group input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .unit {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            color: #666;
            font-weight: 500;
            white-space: nowrap;
        }

        .material-select {
            margin-bottom: 15px;
        }

        .material-select select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .results {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #333;
        }

        .result-value {
            font-size: 1.2em;
            color: #667eea;
            font-weight: 700;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #c33;
        }

        .diagram {
            text-align: center;
            margin: 20px 0;
        }

        .diagram svg {
            max-width: 100%;
            height: auto;
        }

        .parameter-legend {
            margin-top: 15px;
            text-align: left;
            background: #ffffff;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e1e5e9;
        }

        .parameter-legend h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 14px;
        }

        .legend-item {
            display: inline-block;
            margin: 2px 8px 2px 0;
            font-size: 12px;
        }

        .legend-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 4px;
            vertical-align: middle;
            border-radius: 2px;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .info-box h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .info-box ul {
            margin-left: 20px;
        }

        .info-box li {
            margin: 5px 0;
            color: #666;
        }

        /* æ‰“èµç›¸å…³æ ·å¼ */
        .donate-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .donate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(238, 90, 36, 0.6);
        }

        .donate-btn i {
            margin-right: 8px;
        }

        .donate-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        .donate-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
        }

        .donate-title {
            margin: 0 0 20px 0;
            font-size: 24px;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .donate-description {
            margin-bottom: 25px;
            color: #666;
            font-size: 16px;
            line-height: 1.6;
        }

        .qr-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: inline-block;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            border: 3px solid #f0f0f0;
            border-radius: 10px;
        }

        .wechat-text {
            margin-top: 15px;
            color: #09bb07;
            font-weight: 600;
            font-size: 18px;
        }

        .amount-tips {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }

        .amount-tips h4 {
            margin: 0 0 10px 0;
            color: #28a745;
            font-size: 16px;
        }

        .amount-list {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 8px;
        }

        .amount-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .thank-message {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
            margin-top: 15px;
        }

        @media (max-width: 480px) {
            .donate-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
            
            .qr-code {
                width: 180px;
                height: 180px;
            }
            
            .donate-btn {
                bottom: 20px;
                right: 20px;
                padding: 12px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/admin" class="admin-link">âš™ï¸ æ‰“èµè®¾ç½®</a>
            <h1>ğŸ”§ PCBé˜»æŠ—è®¡ç®—å™¨</h1>
            <p>ä¸“ä¸šçš„å°åˆ·ç”µè·¯æ¿ä¼ è¾“çº¿é˜»æŠ—è®¡ç®—å·¥å…·</p>
        </div>

        <!-- æ‰“èµæŒ‰é’® -->
        <button class="donate-btn" onclick="openDonateModal()">
            â¤ï¸ æ‰“èµæ”¯æŒ
        </button>

        <!-- æ‰“èµå¼¹çª— -->
        <div id="donateModal" class="donate-modal">
            <div class="donate-content">
                <span class="close" onclick="closeDonateModal()">&times;</span>
                <h2 class="donate-title">ğŸ’– æ„Ÿè°¢æ‚¨çš„æ”¯æŒ</h2>
                <p class="donate-description">
                    å¦‚æœè¿™ä¸ªPCBé˜»æŠ—è®¡ç®—å™¨å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯·ä½œè€…å–æ¯å’–å•¡â˜•<br>
                    æ‚¨çš„æ”¯æŒæ˜¯æˆ‘ä»¬æŒç»­æ”¹è¿›çš„åŠ¨åŠ›ï¼
                </p>
                
                <div class="qr-container">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI0NSUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNiIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+5b6u5L+h5pS26LKL56CBPC90ZXh0PgogIDx0ZXh0IHg9IjUwJSIgeT0iNjAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiPui/memHjOaUueaIkDwvdGV4dD4KICA8dGV4dCB4PSI1MCUiIHk9IjcwJSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7miafkuIvmlrnlvI88L3RleHQ+Cjwvc3ZnPgo=" 
                         alt="å¾®ä¿¡æ”¶æ¬¾ç " class="qr-code" id="qrCodeImage">
                    <div class="wechat-text" id="qrDescription">å¾®ä¿¡æ‰«ä¸€æ‰«</div>
                </div>

                <div class="amount-tips">
                    <h4>ğŸ’¡ å»ºè®®é‡‘é¢</h4>
                    <div class="amount-list" id="amountList">
                        <span class="amount-tag">ï¿¥5</span>
                        <span class="amount-tag">ï¿¥10</span>
                        <span class="amount-tag">ï¿¥20</span>
                        <span class="amount-tag">ï¿¥50</span>
                    </div>
                </div>

                <div class="thank-message" id="thankMessage">
                    ğŸ™ æ„Ÿè°¢æ‚¨å¯¹å¼€æºé¡¹ç›®çš„æ”¯æŒï¼<br>
                    æ‚¨çš„æ¯ä¸€ä»½å¿ƒæ„éƒ½å°†ç”¨äºé¡¹ç›®çš„ç»´æŠ¤å’ŒåŠŸèƒ½æ”¹è¿›
                </div>
            </div>
        </div>

        <div class="calc-container">
            <div class="calc-card">
                <div class="calc-type">
                    <label for="calcType">è®¡ç®—ç±»å‹ï¼š</label>
                    <select id="calcType" onchange="changeCalculationType()">
                        <option value="microstrip">å¾®å¸¦çº¿ (Microstrip)</option>
                        <option value="stripline">å¸¦çŠ¶çº¿ (Stripline)</option>
                        <option value="differential">å·®åˆ†å¯¹ (Differential Pair)</option>
                        <option value="gssg">GSSGå·®åˆ†å¯¹ (GSSG)</option>
                        <option value="coaxial">åŒè½´çº¿ (Coaxial)</option>
                        <option value="embedded_microstrip">åµŒå…¥å¼å¾®å¸¦çº¿ (Embedded Microstrip)</option>
                        <option value="offset_stripline">åç§»å¸¦çŠ¶çº¿ (Offset Stripline)</option>
                        <option value="gcpw">æ¥åœ°å…±é¢æ³¢å¯¼ (GCPW)</option>
                        <option value="cpwg">CPWGå…±é¢æ³¢å¯¼ (CPWG-GSSG)</option>
                        <option value="broadside_coupled">å®½è¾¹è€¦åˆå¸¦çŠ¶çº¿ (Broadside Coupled)</option>
                    </select>
                </div>

                <div class="material-select">
                    <label for="materialSelect">é¢„è®¾ææ–™ï¼š</label>
                    <select id="materialSelect" onchange="selectMaterial()">
                        <option value="">é€‰æ‹©é¢„è®¾ææ–™...</option>
                    </select>
                </div>

                <form id="calculatorForm">
                    <div id="inputFields"></div>
                    <button type="submit" class="btn">è®¡ç®—é˜»æŠ—</button>
                </form>

                <div id="diagram" class="diagram"></div>
            </div>

            <div class="results">
                <h3>ğŸ“Š è®¡ç®—ç»“æœ</h3>
                <div id="results"></div>
                
                <div class="info-box" id="infoBox"></div>
            </div>
        </div>
    </div>

    <script>
        let materials = {};

        // åŠ è½½ææ–™æ•°æ®
        async function loadMaterials() {
            try {
                const response = await fetch('/api/materials');
                materials = await response.json();
                
                const select = document.getElementById('materialSelect');
                for (const [key, material] of Object.entries(materials)) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = material.name;
                    select.appendChild(option);
                }
            } catch (error) {
                console.error('åŠ è½½ææ–™å¤±è´¥:', error);
            }
        }

        function selectMaterial() {
            const selectedKey = document.getElementById('materialSelect').value;
            if (selectedKey && materials[selectedKey]) {
                const material = materials[selectedKey];
                const dielectricInput = document.querySelector('input[name="dielectric"]');
                const lossTangentInput = document.querySelector('input[name="loss_tangent"]');
                
                if (dielectricInput) dielectricInput.value = material.er;
                if (lossTangentInput) lossTangentInput.value = material.loss_tangent;
            }
        }

        function changeCalculationType() {
            const calcType = document.getElementById('calcType').value;
            const inputFields = document.getElementById('inputFields');
            const diagram = document.getElementById('diagram');
            const infoBox = document.getElementById('infoBox');
            
            let fieldsHTML = '';
            let diagramHTML = '';
            let infoHTML = '';

            switch (calcType) {
                case 'microstrip':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>çº¿å®½ (W)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹è´¨åšåº¦ (H)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é“œåš (T)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="thickness" step="0.001" value="0.035" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹ç”µå¸¸æ•° (Îµr)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="dielectric" step="0.01" value="4.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>æŸè€—è§’æ­£åˆ‡ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="loss_tangent" step="0.0001" value="0.02">
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="300" height="120" viewBox="0 0 300 120">
                            <!-- æ¥åœ°å¹³é¢ -->
                            <rect x="50" y="80" width="200" height="30" fill="#8B4513" stroke="#654321" stroke-width="2"/>
                            <!-- ä¿¡å·çº¿ -->
                            <rect x="120" y="70" width="60" height="10" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- æ ‡æ³¨çº¿å’Œå­—æ¯ -->
                            <!-- çº¿å®½ W -->
                            <line x1="120" y1="60" x2="120" y2="65" stroke="#FF0000" stroke-width="1"/>
                            <line x1="180" y1="60" x2="180" y2="65" stroke="#FF0000" stroke-width="1"/>
                            <line x1="120" y1="62.5" x2="180" y2="62.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="150" y="57" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- ä»‹è´¨åšåº¦ H -->
                            <line x1="35" y1="70" x2="35" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <line x1="33" y1="70" x2="37" y2="70" stroke="#0066FF" stroke-width="1"/>
                            <line x1="33" y1="80" x2="37" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <text x="25" y="78" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">H</text>
                            
                            <!-- é“œåš T -->
                            <line x1="95" y1="70" x2="95" y2="80" stroke="#00AA00" stroke-width="1"/>
                            <line x1="93" y1="70" x2="97" y2="70" stroke="#00AA00" stroke-width="1"/>
                            <line x1="93" y1="80" x2="97" y2="80" stroke="#00AA00" stroke-width="1"/>
                            <text x="85" y="78" text-anchor="middle" font-size="14" fill="#00AA00" font-weight="bold">T</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>W - çº¿å®½</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>H - ä»‹è´¨åšåº¦</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #00AA00;"></span>T - é“œåš</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>å¾®å¸¦çº¿ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>å•é¢æ¥åœ°å¹³é¢</li>
                            <li>é€‚ç”¨äºå¤–å±‚èµ°çº¿</li>
                            <li>æ˜“äºåˆ¶é€ å’Œè°ƒè¯•</li>
                            <li>è¾å°„ç›¸å¯¹è¾ƒå¤§</li>
                        </ul>
                    `;
                    break;

                case 'stripline':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>çº¿å®½ (W)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹è´¨æ€»åšåº¦ (H)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é“œåš (T)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="thickness" step="0.001" value="0.035" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹ç”µå¸¸æ•° (Îµr)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="dielectric" step="0.01" value="4.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="300" height="140" viewBox="0 0 300 140">
                            <!-- ä¸Šæ¥åœ°å±‚ -->
                            <rect x="50" y="40" width="200" height="15" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            <!-- ä»‹è´¨å±‚ -->
                            <rect x="50" y="55" width="200" height="30" fill="#8B4513" stroke="#654321" stroke-width="2"/>
                            <!-- ä¿¡å·çº¿ -->
                            <rect x="120" y="75" width="60" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- ä¸‹æ¥åœ°å±‚ -->
                            <rect x="50" y="85" width="200" height="15" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- æ ‡æ³¨çº¿å’Œå­—æ¯ -->
                            <!-- çº¿å®½ W -->
                            <line x1="120" y1="65" x2="120" y2="70" stroke="#FF0000" stroke-width="1"/>
                            <line x1="180" y1="65" x2="180" y2="70" stroke="#FF0000" stroke-width="1"/>
                            <line x1="120" y1="67.5" x2="180" y2="67.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="150" y="62" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- ä»‹è´¨åšåº¦ H -->
                            <line x1="30" y1="55" x2="30" y2="85" stroke="#0066FF" stroke-width="1"/>
                            <line x1="28" y1="55" x2="32" y2="55" stroke="#0066FF" stroke-width="1"/>
                            <line x1="28" y1="85" x2="32" y2="85" stroke="#0066FF" stroke-width="1"/>
                            <text x="20" y="73" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">H</text>
                            
                            <!-- é“œåš T -->
                            <line x1="270" y1="75" x2="270" y2="85" stroke="#00AA00" stroke-width="1"/>
                            <line x1="268" y1="75" x2="272" y2="75" stroke="#00AA00" stroke-width="1"/>
                            <line x1="268" y1="85" x2="272" y2="85" stroke="#00AA00" stroke-width="1"/>
                            <text x="280" y="83" text-anchor="middle" font-size="14" fill="#00AA00" font-weight="bold">T</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>W - çº¿å®½</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>H - ä»‹è´¨æ€»åšåº¦</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #00AA00;"></span>T - é“œåš</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>å¸¦çŠ¶çº¿ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>åŒé¢æ¥åœ°å¹³é¢</li>
                            <li>é€‚ç”¨äºå†…å±‚èµ°çº¿</li>
                            <li>EMIæ€§èƒ½ä¼˜ç§€</li>
                            <li>çƒ­æ•£å¤±è¾ƒå·®</li>
                        </ul>
                    `;
                    break;

                case 'differential':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>çº¿å®½ (W)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>çº¿é—´è· (S)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="spacing" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹è´¨åšåº¦ (H)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é“œåš (T)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="thickness" step="0.001" value="0.035" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹ç”µå¸¸æ•° (Îµr)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="dielectric" step="0.01" value="4.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="300" height="120" viewBox="0 0 300 120">
                            <!-- æ¥åœ°å¹³é¢ -->
                            <rect x="50" y="80" width="200" height="30" fill="#8B4513" stroke="#654321" stroke-width="2"/>
                            <!-- å·¦ä¿¡å·çº¿ -->
                            <rect x="100" y="70" width="40" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- å³ä¿¡å·çº¿ -->
                            <rect x="160" y="70" width="40" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- æ ‡æ³¨çº¿å’Œå­—æ¯ -->
                            <!-- å·¦ä¿¡å·çº¿å®½åº¦ W -->
                            <line x1="100" y1="55" x2="100" y2="60" stroke="#FF0000" stroke-width="1"/>
                            <line x1="140" y1="55" x2="140" y2="60" stroke="#FF0000" stroke-width="1"/>
                            <line x1="100" y1="57.5" x2="140" y2="57.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="120" y="52" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- å³ä¿¡å·çº¿å®½åº¦ W -->
                            <line x1="160" y1="55" x2="160" y2="60" stroke="#FF0000" stroke-width="1"/>
                            <line x1="200" y1="55" x2="200" y2="60" stroke="#FF0000" stroke-width="1"/>
                            <line x1="160" y1="57.5" x2="200" y2="57.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="180" y="52" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- çº¿é—´è· S -->
                            <line x1="140" y1="75" x2="140" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <line x1="160" y1="75" x2="160" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <line x1="140" y1="77.5" x2="160" y2="77.5" stroke="#0066FF" stroke-width="2"/>
                            <text x="150" y="45" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">S</text>
                            
                            <!-- ä»‹è´¨åšåº¦ H -->
                            <line x1="35" y1="70" x2="35" y2="80" stroke="#00AA00" stroke-width="1"/>
                            <line x1="33" y1="70" x2="37" y2="70" stroke="#00AA00" stroke-width="1"/>
                            <line x1="33" y1="80" x2="37" y2="80" stroke="#00AA00" stroke-width="1"/>
                            <text x="25" y="78" text-anchor="middle" font-size="14" fill="#00AA00" font-weight="bold">H</text>
                            
                            <!-- å·®åˆ†ä¿¡å·æ ‡è¯† -->
                            <path d="M 120 85 Q 150 90 180 85" stroke="#FF4500" stroke-width="2" fill="none"/>
                            <text x="150" y="100" text-anchor="middle" font-size="10" fill="#FF4500">å·®åˆ†å¯¹</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>W - çº¿å®½</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>S - çº¿é—´è·</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #00AA00;"></span>H - ä»‹è´¨åšåº¦</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>å·®åˆ†å¯¹ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>ä¸¤æ ¹ä¿¡å·çº¿ææ€§ç›¸å</li>
                            <li>æŠ—å¹²æ‰°èƒ½åŠ›å¼º</li>
                            <li>é€‚ç”¨äºé«˜é€Ÿä¿¡å·</li>
                            <li>éœ€è¦ä¸¥æ ¼çš„é•¿åº¦åŒ¹é…</li>
                        </ul>
                    `;
                    break;

                case 'coaxial':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>å†…å¯¼ä½“ç›´å¾„ (d)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="inner_diameter" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>å¤–å¯¼ä½“å†…å¾„ (D)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="outer_diameter" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹ç”µå¸¸æ•° (Îµr)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="dielectric" step="0.01" value="2.1" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="300" height="140" viewBox="0 0 300 140">
                            <!-- å¤–å¯¼ä½“ -->
                            <circle cx="150" cy="70" r="50" fill="none" stroke="#8B4513" stroke-width="3"/>
                            <!-- ä»‹è´¨å±‚ -->
                            <circle cx="150" cy="70" r="25" fill="#DEB887" stroke="none" opacity="0.5"/>
                            <!-- å†…å¯¼ä½“ -->
                            <circle cx="150" cy="70" r="8" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- æ ‡æ³¨çº¿å’Œå­—æ¯ -->
                            <!-- å¤–å¯¼ä½“å†…å¾„ D -->
                            <line x1="125" y1="70" x2="175" y2="70" stroke="#FF0000" stroke-width="2"/>
                            <line x1="125" y1="68" x2="125" y2="72" stroke="#FF0000" stroke-width="1"/>
                            <line x1="175" y1="68" x2="175" y2="72" stroke="#FF0000" stroke-width="1"/>
                            <text x="150" y="85" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">D</text>
                            
                            <!-- å†…å¯¼ä½“ç›´å¾„ d -->
                            <line x1="142" y1="70" x2="158" y2="70" stroke="#0066FF" stroke-width="2"/>
                            <line x1="142" y1="68" x2="142" y2="72" stroke="#0066FF" stroke-width="1"/>
                            <line x1="158" y1="68" x2="158" y2="72" stroke="#0066FF" stroke-width="1"/>
                            <text x="150" y="55" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">d</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>d - å†…å¯¼ä½“ç›´å¾„</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>D - å¤–å¯¼ä½“å†…å¾„</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>åŒè½´çº¿ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>åœ†å½¢å¯¹ç§°ç»“æ„</li>
                            <li>ä¼˜ç§€çš„å±è”½æ€§èƒ½</li>
                            <li>å¸¦å®½å¤§ï¼ŒæŸè€—ä½</li>
                            <li>é€‚ç”¨äºé«˜é¢‘åº”ç”¨</li>
                        </ul>
                    `;
                    break;

                case 'gssg':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>ä¿¡å·çº¿å®½ (W)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä¿¡å·é—´è· (S)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="spacing" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>åœ°çº¿é—´è· (G)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="ground_spacing" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹è´¨åšåº¦ (H)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é“œåš (T)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="thickness" step="0.001" value="0.035" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹ç”µå¸¸æ•° (Îµr)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="dielectric" step="0.01" value="4.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="350" height="120" viewBox="0 0 350 120">
                            <!-- æ¥åœ°å¹³é¢ -->
                            <rect x="50" y="80" width="250" height="30" fill="#8B4513" stroke="#654321" stroke-width="2"/>
                            <!-- å·¦åœ°çº¿ -->
                            <rect x="70" y="70" width="30" height="10" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            <!-- å·¦ä¿¡å·çº¿ -->
                            <rect x="120" y="70" width="30" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- å³ä¿¡å·çº¿ -->
                            <rect x="170" y="70" width="30" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- å³åœ°çº¿ -->
                            <rect x="220" y="70" width="30" height="10" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- ç»“æ„æ ‡æ³¨ -->
                            <text x="85" y="65" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">G</text>
                            <text x="135" y="65" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">S</text>
                            <text x="185" y="65" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">S</text>
                            <text x="235" y="65" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">G</text>
                            
                            <!-- å°ºå¯¸æ ‡æ³¨ -->
                            <!-- ä¿¡å·çº¿å®½ W -->
                            <line x1="120" y1="55" x2="120" y2="60" stroke="#FF0000" stroke-width="1"/>
                            <line x1="150" y1="55" x2="150" y2="60" stroke="#FF0000" stroke-width="1"/>
                            <line x1="120" y1="57.5" x2="150" y2="57.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="135" y="52" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- ä¿¡å·é—´è· S -->
                            <line x1="150" y1="85" x2="150" y2="90" stroke="#0066FF" stroke-width="1"/>
                            <line x1="170" y1="85" x2="170" y2="90" stroke="#0066FF" stroke-width="1"/>
                            <line x1="150" y1="87.5" x2="170" y2="87.5" stroke="#0066FF" stroke-width="2"/>
                            <text x="160" y="100" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">S</text>
                            
                            <!-- åœ°çº¿é—´è· G -->
                            <line x1="100" y1="75" x2="100" y2="80" stroke="#00AA00" stroke-width="1"/>
                            <line x1="120" y1="75" x2="120" y2="80" stroke="#00AA00" stroke-width="1"/>
                            <line x1="100" y1="77.5" x2="120" y2="77.5" stroke="#00AA00" stroke-width="2"/>
                            <text x="110" y="45" text-anchor="middle" font-size="14" fill="#00AA00" font-weight="bold">G</text>
                            
                            <!-- å·®åˆ†ä¿¡å·æ ‡è¯† -->
                            <path d="M 135 85 Q 160 90 185 85" stroke="#FF4500" stroke-width="2" fill="none"/>
                            <text x="160" y="110" text-anchor="middle" font-size="10" fill="#FF4500">å·®åˆ†å¯¹</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>GSSG (G-S-S-G) å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>W - ä¿¡å·çº¿å®½</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>S - ä¿¡å·é—´è·</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #00AA00;"></span>G - åœ°çº¿é—´è·</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>GSSGç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>Ground-Signal-Signal-Groundé…ç½®</li>
                            <li>ä¼˜ç§€çš„ä¿¡å·éš”ç¦»</li>
                            <li>å‡å°‘ä¸²æ‰°å’ŒEMI</li>
                            <li>é€‚ç”¨äºé«˜é€Ÿå·®åˆ†ä¿¡å·</li>
                        </ul>
                    `;
                    break;

                case 'embedded_microstrip':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>çº¿å®½ (W)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä¸Šå±‚åšåº¦ (H1)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="upper_height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä¸‹å±‚åšåº¦ (H2)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="lower_height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é“œåš (T)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="thickness" step="0.001" value="0.035" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä¸Šå±‚ä»‹ç”µå¸¸æ•° (Îµr1)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="upper_dielectric" step="0.01" value="3.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä¸‹å±‚ä»‹ç”µå¸¸æ•° (Îµr2)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="lower_dielectric" step="0.01" value="4.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="300" height="150" viewBox="0 0 300 150">
                            <!-- ä¸Šå±‚ä»‹è´¨ -->
                            <rect x="50" y="30" width="200" height="25" fill="#ADD8E6" stroke="#87CEEB" stroke-width="2"/>
                            <!-- ä¸‹å±‚ä»‹è´¨ -->
                            <rect x="50" y="65" width="200" height="35" fill="#DEB887" stroke="#8B4513" stroke-width="2"/>
                            <!-- ä¿¡å·çº¿ -->
                            <rect x="120" y="55" width="60" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- æ¥åœ°å±‚ -->
                            <rect x="50" y="100" width="200" height="15" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- æ ‡æ³¨çº¿å’Œå­—æ¯ -->
                            <!-- çº¿å®½ W -->
                            <line x1="120" y1="45" x2="120" y2="50" stroke="#FF0000" stroke-width="1"/>
                            <line x1="180" y1="45" x2="180" y2="50" stroke="#FF0000" stroke-width="1"/>
                            <line x1="120" y1="47.5" x2="180" y2="47.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="150" y="42" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- ä¸Šå±‚åšåº¦ H1 -->
                            <line x1="30" y1="30" x2="30" y2="55" stroke="#0066FF" stroke-width="1"/>
                            <line x1="28" y1="30" x2="32" y2="30" stroke="#0066FF" stroke-width="1"/>
                            <line x1="28" y1="55" x2="32" y2="55" stroke="#0066FF" stroke-width="1"/>
                            <text x="20" y="45" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">H1</text>
                            
                            <!-- ä¸‹å±‚åšåº¦ H2 -->
                            <line x1="270" y1="65" x2="270" y2="100" stroke="#00AA00" stroke-width="1"/>
                            <line x1="268" y1="65" x2="272" y2="65" stroke="#00AA00" stroke-width="1"/>
                            <line x1="268" y1="100" x2="272" y2="100" stroke="#00AA00" stroke-width="1"/>
                            <text x="280" y="85" text-anchor="middle" font-size="14" fill="#00AA00" font-weight="bold">H2</text>
                            
                            <!-- ææ–™æ ‡æ³¨ -->
                            <text x="65" y="45" text-anchor="start" font-size="10" fill="#333">Îµr1</text>
                            <text x="65" y="85" text-anchor="start" font-size="10" fill="#333">Îµr2</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>W - çº¿å®½</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>H1 - ä¸Šå±‚åšåº¦</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #00AA00;"></span>H2 - ä¸‹å±‚åšåº¦</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>åµŒå…¥å¼å¾®å¸¦çº¿ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>å¤šå±‚ä»‹è´¨ç»“æ„</li>
                            <li>å¯ä¼˜åŒ–ä»‹ç”µæ€§èƒ½</li>
                            <li>é€‚ç”¨äºæ··åˆææ–™è®¾è®¡</li>
                            <li>æ§åˆ¶é˜»æŠ—æ›´çµæ´»</li>
                        </ul>
                    `;
                    break;

                case 'offset_stripline':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>çº¿å®½ (W)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>æ€»åšåº¦ (H)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="total_height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>åˆ°ä¸‹å±‚è·ç¦» (B)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="bottom_distance" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é“œåš (T)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="thickness" step="0.001" value="0.035" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹ç”µå¸¸æ•° (Îµr)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="dielectric" step="0.01" value="4.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="300" height="150" viewBox="0 0 300 150">
                            <!-- ä¸Šæ¥åœ°å±‚ -->
                            <rect x="50" y="30" width="200" height="15" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            <!-- ä»‹è´¨å±‚ -->
                            <rect x="50" y="45" width="200" height="50" fill="#DEB887" stroke="#8B4513" stroke-width="2" opacity="0.7"/>
                            <!-- åç§»ä¿¡å·çº¿ -->
                            <rect x="120" y="75" width="60" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- ä¸‹æ¥åœ°å±‚ -->
                            <rect x="50" y="95" width="200" height="15" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- æ ‡æ³¨çº¿å’Œå­—æ¯ -->
                            <!-- çº¿å®½ W -->
                            <line x1="120" y1="65" x2="120" y2="70" stroke="#FF0000" stroke-width="1"/>
                            <line x1="180" y1="65" x2="180" y2="70" stroke="#FF0000" stroke-width="1"/>
                            <line x1="120" y1="67.5" x2="180" y2="67.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="150" y="62" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- åˆ°ä¸‹å±‚è·ç¦» B -->
                            <line x1="270" y1="85" x2="270" y2="95" stroke="#0066FF" stroke-width="1"/>
                            <line x1="268" y1="85" x2="272" y2="85" stroke="#0066FF" stroke-width="1"/>
                            <line x1="268" y1="95" x2="272" y2="95" stroke="#0066FF" stroke-width="1"/>
                            <text x="280" y="93" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">B</text>
                            
                            <!-- åˆ°ä¸Šå±‚è·ç¦» A -->
                            <line x1="270" y1="45" x2="270" y2="75" stroke="#00AA00" stroke-width="1"/>
                            <line x1="268" y1="45" x2="272" y2="45" stroke="#00AA00" stroke-width="1"/>
                            <line x1="268" y1="75" x2="272" y2="75" stroke="#00AA00" stroke-width="1"/>
                            <text x="280" y="63" text-anchor="middle" font-size="14" fill="#00AA00" font-weight="bold">A</text>
                            
                            <!-- æ€»åšåº¦ H -->
                            <line x1="30" y1="45" x2="30" y2="95" stroke="#8B008B" stroke-width="1"/>
                            <line x1="28" y1="45" x2="32" y2="45" stroke="#8B008B" stroke-width="1"/>
                            <line x1="28" y1="95" x2="32" y2="95" stroke="#8B008B" stroke-width="1"/>
                            <text x="20" y="73" text-anchor="middle" font-size="14" fill="#8B008B" font-weight="bold">H</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>W - çº¿å®½</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #8B008B;"></span>H - æ€»åšåº¦</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>B - åˆ°ä¸‹å±‚è·ç¦»</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>åç§»å¸¦çŠ¶çº¿ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>ä¿¡å·çº¿åç¦»ä¸­å¿ƒä½ç½®</li>
                            <li>ä¸å¯¹ç§°ç»“æ„</li>
                            <li>å¯æ§åˆ¶é˜»æŠ—ç‰¹æ€§</li>
                            <li>é€‚ç”¨äºå±‚å é™åˆ¶æƒ…å†µ</li>
                        </ul>
                    `;
                    break;

                case 'gcpw':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>ä¿¡å·çº¿å®½ (W)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é—´éš™å®½åº¦ (S)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="gap" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹è´¨åšåº¦ (H)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é“œåš (T)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="thickness" step="0.001" value="0.035" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹ç”µå¸¸æ•° (Îµr)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="dielectric" step="0.01" value="4.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="300" height="120" viewBox="0 0 300 120">
                            <!-- èƒŒé¢æ¥åœ°å±‚ -->
                            <rect x="50" y="80" width="200" height="30" fill="#8B4513" stroke="#654321" stroke-width="2"/>
                            <!-- å·¦åœ°çº¿ -->
                            <rect x="60" y="70" width="50" height="10" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            <!-- ä¿¡å·çº¿ -->
                            <rect x="130" y="70" width="40" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- å³åœ°çº¿ -->
                            <rect x="190" y="70" width="50" height="10" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- æ ‡æ³¨çº¿å’Œå­—æ¯ -->
                            <text x="85" y="65" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">G</text>
                            <text x="150" y="65" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">S</text>
                            <text x="215" y="65" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">G</text>
                            
                            <!-- çº¿å®½ W -->
                            <line x1="130" y1="55" x2="130" y2="60" stroke="#FF0000" stroke-width="1"/>
                            <line x1="170" y1="55" x2="170" y2="60" stroke="#FF0000" stroke-width="1"/>
                            <line x1="130" y1="57.5" x2="170" y2="57.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="150" y="52" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- é—´éš™ S -->
                            <line x1="110" y1="75" x2="110" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <line x1="130" y1="75" x2="130" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <line x1="110" y1="77.5" x2="130" y2="77.5" stroke="#0066FF" stroke-width="2"/>
                            <text x="120" y="45" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">S</text>
                            
                            <!-- ä»‹è´¨åšåº¦ H -->
                            <line x1="35" y1="70" x2="35" y2="80" stroke="#00AA00" stroke-width="1"/>
                            <line x1="33" y1="70" x2="37" y2="70" stroke="#00AA00" stroke-width="1"/>
                            <line x1="33" y1="80" x2="37" y2="80" stroke="#00AA00" stroke-width="1"/>
                            <text x="25" y="78" text-anchor="middle" font-size="14" fill="#00AA00" font-weight="bold">H</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>GCPW (G-S-G) å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>W - ä¿¡å·çº¿å®½</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>S - é—´éš™å®½åº¦</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #00AA00;"></span>H - ä»‹è´¨åšåº¦</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>GCPWç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>åŒå±‚åœ°çº¿å±è”½</li>
                            <li>ä¼˜ç§€çš„ä¿¡å·å®Œæ•´æ€§</li>
                            <li>å‡å°‘æ¨¡å¼è½¬æ¢</li>
                            <li>é€‚ç”¨äºé«˜é¢‘RFè®¾è®¡</li>
                        </ul>
                    `;
                    break;

                case 'cpwg':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>å•ä¸ªä¿¡å·çº¿å®½ (W)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                            <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">æ¯ä¸ªä¿¡å·çº¿çš„å®½åº¦ï¼Œä¸¤æ ¹ä¿¡å·çº¿å®½åº¦ç›¸åŒ</small>
                        </div>
                        <div class="input-group">
                            <label>ä¿¡å·çº¿é—´è· (S)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="gap" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                            <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">ä¸¤ä¸ªä¿¡å·çº¿ä¸­å¿ƒä¹‹é—´çš„è·ç¦»</small>
                        </div>
                        <div class="input-group">
                            <label>ä¿¡å·åˆ°åœ°é—´è· (G)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="signal_to_ground" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                            <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">ä¿¡å·çº¿è¾¹ç¼˜åˆ°ä¾§è¾¹åœ°çº¿è¾¹ç¼˜çš„è·ç¦»</small>
                        </div>
                        <div class="input-group">
                            <label>åœ°çº¿å®½åº¦ (GW)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="ground_width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                            <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">ä¾§è¾¹åœ°çº¿çš„å®½åº¦</small>
                        </div>
                        <div class="input-group">
                            <label>ä»‹è´¨åšåº¦ (H)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é‡‘å±åšåº¦ (T)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="thickness" step="0.001" value="0.035" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹ç”µå¸¸æ•° (Îµr)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="dielectric" step="0.01" value="4.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="380" height="180" viewBox="0 0 380 180">
                            <!-- èƒŒé¢æ¥åœ°å±‚ -->
                            <rect x="20" y="120" width="340" height="15" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- ä»‹è´¨å±‚ -->
                            <rect x="20" y="70" width="340" height="50" fill="#DEB887" stroke="#8B4513" stroke-width="1" opacity="0.7"/>
                            
                            <!-- è¡¨é¢é‡‘å±å±‚ - å®Œæ•´çš„GSSGç»“æ„ -->
                            <!-- å·¦åœ°çº¿ G -->
                            <rect x="30" y="60" width="60" height="10" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            <!-- å·¦ä¿¡å·çº¿ S1 -->
                            <rect x="110" y="60" width="40" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- å³ä¿¡å·çº¿ S2 -->
                            <rect x="170" y="60" width="40" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- å³åœ°çº¿ G -->
                            <rect x="230" y="60" width="60" height="10" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- ç»“æ„æ ‡æ³¨ -->
                            <text x="60" y="55" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">G</text>
                            <text x="130" y="55" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">S</text>
                            <text x="190" y="55" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">S</text>
                            <text x="260" y="55" text-anchor="middle" font-size="12" fill="#333" font-weight="bold">G</text>
                            
                            <!-- å°ºå¯¸æ ‡æ³¨ -->
                            <!-- åœ°çº¿å®½åº¦ GW -->
                            <line x1="30" y1="35" x2="30" y2="45" stroke="#8B008B" stroke-width="1"/>
                            <line x1="90" y1="35" x2="90" y2="45" stroke="#8B008B" stroke-width="1"/>
                            <line x1="30" y1="40" x2="90" y2="40" stroke="#8B008B" stroke-width="2"/>
                            <text x="60" y="30" text-anchor="middle" font-size="14" fill="#8B008B" font-weight="bold">GW</text>
                            
                            <!-- ä¿¡å·åˆ°åœ°é—´è· G -->
                            <line x1="90" y1="45" x2="90" y2="50" stroke="#00AA00" stroke-width="1"/>
                            <line x1="110" y1="45" x2="110" y2="50" stroke="#00AA00" stroke-width="1"/>
                            <line x1="90" y1="47.5" x2="110" y2="47.5" stroke="#00AA00" stroke-width="2"/>
                            <text x="100" y="42" text-anchor="middle" font-size="14" fill="#00AA00" font-weight="bold">G</text>
                            
                            <!-- ä¿¡å·çº¿å®½åº¦W -->
                            <line x1="110" y1="15" x2="110" y2="20" stroke="#FF0000" stroke-width="1"/>
                            <line x1="150" y1="15" x2="150" y2="20" stroke="#FF0000" stroke-width="1"/>
                            <line x1="110" y1="17.5" x2="150" y2="17.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="130" y="12" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- ä¿¡å·çº¿é—´è·S -->
                            <line x1="150" y1="75" x2="150" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <line x1="170" y1="75" x2="170" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <line x1="150" y1="77.5" x2="170" y2="77.5" stroke="#0066FF" stroke-width="2"/>
                            <text x="160" y="90" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">S</text>
                            
                            <!-- ä»‹è´¨åšåº¦H -->
                            <line x1="10" y1="70" x2="10" y2="120" stroke="#666" stroke-width="1"/>
                            <line x1="8" y1="70" x2="12" y2="70" stroke="#666" stroke-width="1"/>
                            <line x1="8" y1="120" x2="12" y2="120" stroke="#666" stroke-width="1"/>
                            <text x="5" y="98" text-anchor="middle" font-size="14" fill="#666" font-weight="bold">H</text>
                            
                            <!-- å·®åˆ†ä¿¡å·æ ‡è¯† -->
                            <path d="M 130 80 Q 160 85 190 80" stroke="#FF4500" stroke-width="2" fill="none"/>
                            <text x="160" y="100" text-anchor="middle" font-size="10" fill="#FF4500">å·®åˆ†å¯¹</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>CPWG (G-S-S-G) å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>W - ä¿¡å·çº¿å®½åº¦</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>S - ä¿¡å·çº¿é—´è·</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #00AA00;"></span>G - ä¿¡å·åˆ°åœ°é—´è·</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #8B008B;"></span>GW - åœ°çº¿å®½åº¦</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #666;"></span>H - ä»‹è´¨åšåº¦</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>CPWG (G-S-S-G) å·®åˆ†å¯¹ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>ğŸ”¹ ä¸¤ä¸ªä¿¡å·çº¿ç»„æˆå·®åˆ†å¯¹</li>
                            <li>ğŸ”¹ è¡¨å±‚ä¾§è¾¹æ¥åœ° + èƒŒé¢æ¥åœ°</li>
                            <li>ğŸ”¹ ä¼˜ç§€çš„å·®åˆ†ä¿¡å·å®Œæ•´æ€§</li>
                            <li>ğŸ”¹ æä½çš„å…±æ¨¡è¾å°„</li>
                            <li>ğŸ”¹ é«˜é¢‘æ€§èƒ½å“è¶Š</li>
                            <li>ğŸ”¹ é€‚ç”¨äºé«˜é€Ÿå·®åˆ†ä¿¡å·</li>
                        </ul>
                    `;
                    break;

                case 'broadside_coupled':
                    fieldsHTML = `
                        <div class="input-group">
                            <label>çº¿å®½ (W)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="width" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹è´¨åšåº¦ (H)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="height" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>å‚ç›´é—´è· (S)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="vertical_spacing" step="0.001" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>é“œåš (T)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="thickness" step="0.001" value="0.035" required>
                                <span class="unit">mm</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ä»‹ç”µå¸¸æ•° (Îµr)ï¼š</label>
                            <div class="input-row">
                                <input type="number" name="dielectric" step="0.01" value="4.3" required>
                                <span class="unit"></span>
                            </div>
                        </div>
                    `;
                    
                    diagramHTML = `
                        <svg width="300" height="160" viewBox="0 0 300 160">
                            <!-- ä¸Šæ¥åœ°å±‚ -->
                            <rect x="50" y="30" width="200" height="15" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            <!-- ä¸Šä»‹è´¨å±‚ -->
                            <rect x="50" y="45" width="200" height="25" fill="#DEB887" stroke="#8B4513" stroke-width="1" opacity="0.7"/>
                            <!-- ä¸Šä¿¡å·çº¿ -->
                            <rect x="120" y="60" width="60" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- ä¸­é—´ä»‹è´¨å±‚ -->
                            <rect x="50" y="70" width="200" height="10" fill="#8B4513" stroke="#654321" stroke-width="2"/>
                            <!-- ä¸‹ä¿¡å·çº¿ -->
                            <rect x="120" y="80" width="60" height="10" fill="#FFD700" stroke="#8B4513" stroke-width="1"/>
                            <!-- ä¸‹ä»‹è´¨å±‚ -->
                            <rect x="50" y="90" width="200" height="25" fill="#DEB887" stroke="#8B4513" stroke-width="1" opacity="0.7"/>
                            <!-- ä¸‹æ¥åœ°å±‚ -->
                            <rect x="50" y="115" width="200" height="15" fill="#CD853F" stroke="#8B4513" stroke-width="1"/>
                            
                            <!-- æ ‡æ³¨çº¿å’Œå­—æ¯ -->
                            <!-- çº¿å®½ W -->
                            <line x1="120" y1="50" x2="120" y2="55" stroke="#FF0000" stroke-width="1"/>
                            <line x1="180" y1="50" x2="180" y2="55" stroke="#FF0000" stroke-width="1"/>
                            <line x1="120" y1="52.5" x2="180" y2="52.5" stroke="#FF0000" stroke-width="2"/>
                            <text x="150" y="47" text-anchor="middle" font-size="14" fill="#FF0000" font-weight="bold">W</text>
                            
                            <!-- å‚ç›´é—´è· S -->
                            <line x1="270" y1="70" x2="270" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <line x1="268" y1="70" x2="272" y2="70" stroke="#0066FF" stroke-width="1"/>
                            <line x1="268" y1="80" x2="272" y2="80" stroke="#0066FF" stroke-width="1"/>
                            <text x="280" y="78" text-anchor="middle" font-size="14" fill="#0066FF" font-weight="bold">S</text>
                            
                            <!-- ä»‹è´¨åšåº¦ H -->
                            <line x1="30" y1="45" x2="30" y2="70" stroke="#00AA00" stroke-width="1"/>
                            <line x1="28" y1="45" x2="32" y2="45" stroke="#00AA00" stroke-width="1"/>
                            <line x1="28" y1="70" x2="32" y2="70" stroke="#00AA00" stroke-width="1"/>
                            <text x="20" y="60" text-anchor="middle" font-size="14" fill="#00AA00" font-weight="bold">H</text>
                            
                            <!-- å·®åˆ†ä¿¡å·æ ‡è¯† -->
                            <path d="M 190 65 Q 200 70 190 85" stroke="#FF4500" stroke-width="2" fill="none"/>
                            <text x="210" y="78" text-anchor="middle" font-size="10" fill="#FF4500">å·®åˆ†å¯¹</text>
                        </svg>
                        
                        <div class="parameter-legend">
                            <h4>å‚æ•°è¯´æ˜ï¼š</h4>
                            <span class="legend-item"><span class="legend-color" style="background-color: #FF0000;"></span>W - çº¿å®½</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #0066FF;"></span>S - å‚ç›´é—´è·</span>
                            <span class="legend-item"><span class="legend-color" style="background-color: #00AA00;"></span>H - ä»‹è´¨åšåº¦</span>
                        </div>
                    `;
                    
                    infoHTML = `
                        <h4>å®½è¾¹è€¦åˆç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>å‚ç›´å±‚é—´è€¦åˆ</li>
                            <li>ç´§å¯†çš„è€¦åˆç‰¹æ€§</li>
                            <li>èŠ‚çœæ°´å¹³ç©ºé—´</li>
                            <li>é€‚ç”¨äºé«˜å¯†åº¦è®¾è®¡</li>
                        </ul>
                    `;
                    break;
            }

            inputFields.innerHTML = fieldsHTML;
            diagram.innerHTML = diagramHTML;
            infoBox.innerHTML = infoHTML;
        }

        document.getElementById('calculatorForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const calcType = document.getElementById('calcType').value;
            const formData = new FormData(e.target);
            const params = {};
            
            for (let [key, value] of formData.entries()) {
                params[key] = parseFloat(value);
            }
            
            try {
                const response = await fetch('/api/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: calcType,
                        params: params
                    })
                });
                
                const result = await response.json();
                displayResults(result, calcType);
            } catch (error) {
                displayError('è®¡ç®—å¤±è´¥ï¼š' + error.message);
            }
        });

        function displayResults(result, calcType) {
            const resultsDiv = document.getElementById('results');
            
            if (result.status === 'error') {
                resultsDiv.innerHTML = `<div class="error">é”™è¯¯: ${result.message}</div>`;
                return;
            }
            
            let html = '';
            
            if (calcType === 'differential') {
                html = `
                    <div class="result-item">
                        <span class="result-label">å·®åˆ†é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.differential_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å•ç«¯é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.single_ended_impedance} Î©</span>
                    </div>
                `;
                
                if (result.odd_mode_impedance) {
                    html += `
                        <div class="result-item">
                            <span class="result-label">å¥‡æ¨¡é˜»æŠ—ï¼š</span>
                            <span class="result-value">${result.odd_mode_impedance} Î©</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">å¶æ¨¡é˜»æŠ—ï¼š</span>
                            <span class="result-value">${result.even_mode_impedance} Î©</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">å…±æ¨¡é˜»æŠ—ï¼š</span>
                            <span class="result-value">${result.common_mode_impedance} Î©</span>
                        </div>
                    `;
                }
                
                html += `
                    <div class="result-item">
                        <span class="result-label">è€¦åˆç³»æ•°ï¼š</span>
                        <span class="result-value">${result.coupling_coefficient}</span>
                    </div>
                `;
            } else if (calcType === 'gssg') {
                html = `
                    <div class="result-item">
                        <span class="result-label">å·®åˆ†é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.differential_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å…±æ¨¡é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.common_mode_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å•ç«¯é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.single_ended_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">è€¦åˆå› å­ï¼š</span>
                        <span class="result-value">${result.coupling_factor}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">åœ°çº¿è€¦åˆï¼š</span>
                        <span class="result-value">${result.ground_coupling}</span>
                    </div>
                `;
                if (result.er_eff) {
                    html += `
                        <div class="result-item">
                            <span class="result-label">æœ‰æ•ˆä»‹ç”µå¸¸æ•°ï¼š</span>
                            <span class="result-value">${result.er_eff}</span>
                        </div>
                    `;
                }
            } else if (calcType === 'embedded_microstrip') {
                html = `
                    <div class="result-item">
                        <span class="result-label">ç‰¹å¾é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ç­‰æ•ˆä»‹ç”µå¸¸æ•°ï¼š</span>
                        <span class="result-value">${result.er_eff}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ç­‰æ•ˆåšåº¦ï¼š</span>
                        <span class="result-value">${result.h_eff} mm</span>
                    </div>
                `;
            } else if (calcType === 'offset_stripline') {
                html = `
                    <div class="result-item">
                        <span class="result-label">ç‰¹å¾é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">åç§»ä¿®æ­£ç³»æ•°ï¼š</span>
                        <span class="result-value">${result.offset_factor}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ä¸Šå±‚è·ç¦»ï¼š</span>
                        <span class="result-value">${result.upper_distance} mm</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ä¸‹å±‚è·ç¦»ï¼š</span>
                        <span class="result-value">${result.lower_distance} mm</span>
                    </div>
                `;
            } else if (calcType === 'gcpw') {
                html = `
                    <div class="result-item">
                        <span class="result-label">ç‰¹å¾é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">æœ‰æ•ˆä»‹ç”µå¸¸æ•°ï¼š</span>
                        <span class="result-value">${result.er_eff}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Kå‚æ•°ï¼š</span>
                        <span class="result-value">${result.k_parameter}</span>
                    </div>
                `;
            } else if (calcType === 'cpwg') {
                html = `
                    <div class="result-item">
                        <span class="result-label">å·®åˆ†é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.differential_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å•ç«¯é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.single_ended_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å…±æ¨¡é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.common_mode_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å¥‡æ¨¡é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.odd_mode_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å¶æ¨¡é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.even_mode_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">æœ‰æ•ˆä»‹ç”µå¸¸æ•°ï¼š</span>
                        <span class="result-value">${result.er_eff}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">è€¦åˆç³»æ•°ï¼š</span>
                        <span class="result-value">${result.coupling_coefficient}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å¡«å……å› å­ï¼š</span>
                        <span class="result-value">${result.filling_factor}</span>
                    </div>
                `;
                
                if (result.conductor_loss) {
                    html += `
                        <div class="result-item">
                            <span class="result-label">å¯¼ä½“æŸè€—ï¼š</span>
                            <span class="result-value">${result.conductor_loss} dB/cm</span>
                        </div>
                    `;
                }
                
                if (result.dielectric_loss) {
                    html += `
                        <div class="result-item">
                            <span class="result-label">ä»‹è´¨æŸè€—ï¼š</span>
                            <span class="result-value">${result.dielectric_loss} dB/cm</span>
                        </div>
                    `;
                }
            } else if (calcType === 'broadside_coupled') {
                html = `
                    <div class="result-item">
                        <span class="result-label">å·®åˆ†é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.differential_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å…±æ¨¡é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.common_mode_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å•ç«¯é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.single_ended_impedance} Î©</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">è€¦åˆå› å­ï¼š</span>
                        <span class="result-value">${result.coupling_factor}</span>
                    </div>
                `;
            } else {
                html = `
                    <div class="result-item">
                        <span class="result-label">ç‰¹å¾é˜»æŠ—ï¼š</span>
                        <span class="result-value">${result.impedance} Î©</span>
                    </div>
                `;
                
                if (result.er_eff) {
                    html += `
                        <div class="result-item">
                            <span class="result-label">æœ‰æ•ˆä»‹ç”µå¸¸æ•°ï¼š</span>
                            <span class="result-value">${result.er_eff}</span>
                        </div>
                    `;
                }
            }
            
            resultsDiv.innerHTML = html;
        }

        function displayError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<div class="error">${message}</div>`;
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            loadMaterials();
            changeCalculationType();
        });

        // æ‰“èµç›¸å…³å‡½æ•°
        function openDonateModal() {
            document.getElementById('donateModal').style.display = 'block';
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
        }

        function closeDonateModal() {
            document.getElementById('donateModal').style.display = 'none';
            document.body.style.overflow = 'auto'; // æ¢å¤æ»šåŠ¨
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('donateModal');
            if (event.target === modal) {
                closeDonateModal();
            }
        });

        // ESCé”®å…³é—­æ¨¡æ€æ¡†
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeDonateModal();
            }
        });

        // ä¸Šä¼ äºŒç»´ç å›¾ç‰‡åŠŸèƒ½
        function uploadQRCode() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('qrCodeImage').src = e.target.result;
                        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                        localStorage.setItem('donateQRCode', e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // åŠ è½½ä¿å­˜çš„äºŒç»´ç å’Œè®¾ç½®
        function loadSavedQRCode() {
            const savedQR = localStorage.getItem('donateQRCode');
            const qrDescription = localStorage.getItem('qrDescription');
            const suggestedAmounts = localStorage.getItem('suggestedAmounts');
            const thankMessage = localStorage.getItem('thankMessage');

            // åŠ è½½äºŒç»´ç 
            if (savedQR) {
                document.getElementById('qrCodeImage').src = savedQR;
            }

            // åŠ è½½æè¿°
            if (qrDescription) {
                document.getElementById('qrDescription').textContent = qrDescription;
            }

            // åŠ è½½å»ºè®®é‡‘é¢
            if (suggestedAmounts) {
                const amounts = suggestedAmounts.split(',').map(a => a.trim()).filter(a => a);
                const amountList = document.getElementById('amountList');
                amountList.innerHTML = amounts.map(amount => 
                    `<span class="amount-tag">ï¿¥${amount}</span>`
                ).join('');
            }

            // åŠ è½½æ„Ÿè°¢æ–‡æ¡ˆ
            if (thankMessage) {
                document.getElementById('thankMessage').innerHTML = thankMessage.replace(/\n/g, '<br>');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„äºŒç»´ç 
        window.addEventListener('load', function() {
            loadMaterials();
            changeCalculationType();
            loadSavedQRCode();
        });
    </script>
</body>
</html>